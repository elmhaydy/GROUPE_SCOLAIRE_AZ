{% extends "prof/base_prof.html" %}
{% load static %}
{% load az_dict %}

{% block title %}Emploi du temps | Prof{% endblock %}
{% block page_title %}Emploi du temps{% endblock %}
{% block current_page %}Emploi du temps{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'prof/css/edt.css' %}?v=3">
{% endblock %}

{% block extra_js %}
<script src="{% static 'prof/js/edt.js' %}?v=1" defer></script>
{% endblock %}

{% block content %}
<div class="az-edt">

  <!-- Header / filtres -->
  <div class="az-card az-edt-head">
    <div class="az-edt-head-left">
      <div class="az-edt-pill">
        <i class="fa-solid fa-calendar-days"></i>
        <span>Prof</span><span class="sep">•</span><span>Emploi du temps</span>
      </div>
      <h2 class="az-edt-title">Semaine type</h2>
      <p class="az-edt-sub muted">
        Année active :
        <b>{% if annee_active %}{{ annee_active.nom }}{% else %}—{% endif %}</b>
      </p>
    </div>

    <form class="az-edt-filters" method="get">
      <div class="az-edt-field">
        <label>Groupe</label>
        <select name="groupe" id="groupe">
          <option value="">Tous</option>
          {% for g in groupes %}
            <option value="{{ g.id }}" {% if groupe_selected == g.id|stringformat:"s" %}selected{% endif %}>
              {{ g.niveau.degre.nom }} • {{ g.niveau.nom }} • {{ g.nom }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="az-edt-actions">
        <button class="az-btn az-btn-primary" type="submit">
          <i class="fa-solid fa-filter"></i> Filtrer
        </button>
        <a class="az-btn az-btn-secondary" href="{% url 'prof:edt' %}">
          <i class="fa-solid fa-rotate-left"></i> Reset
        </a>
      </div>
    </form>
  </div>

  <!-- Grille -->

  <div class="az-card az-edt-wrap">
    {% if has_slots %}
      <div class="az-edt-scroll">
        <table class="az-edt-table">
          <thead>
            <tr>
              <th class="az-edt-daycol">Jour</th>
              {% for s in slot_labels %}
                <th class="az-edt-slotcol">
                  <div class="az-edt-slotnum">{{ s.num }}</div>
                  <div class="az-edt-slottime">{{ s.start }}–{{ s.end }}</div>
                </th>
              {% endfor %}
            </tr>
          </thead>

<tbody>
  {% for r in rows %}
    <tr>
      <td class="az-edt-day">
        <div class="az-edt-daybig">{{ r.short }}</div>
      </td>

      {% for c in r.cells %}
        <td class="az-edt-cell" colspan="{{ c.colspan }}">
          {% if c.kind == "event" and c.items %}
            <div class="az-edt-cellstack">
              {% for se in c.items %}
                <div class="az-edt-chip">
                  <div class="az-edt-matiere">{{ se.matiere|default:"—" }}</div>
                  <div class="az-edt-time">
                    {{ se.heure_debut|time:"H:i" }}–{{ se.heure_fin|time:"H:i" }}
                  </div>
                  <div class="az-edt-meta">
                    <span class="tag">{{ se.groupe.niveau.nom }} • {{ se.groupe.nom }}</span>
                    {% if se.salle %}
                      <span class="tag ghost">
                        <i class="fa-solid fa-location-dot"></i> {{ se.salle }}
                      </span>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <div class="az-edt-empty">—</div>
          {% endif %}
        </td>
      {% endfor %}
    </tr>
  {% endfor %}
</tbody>

        </table>
      </div>
    {% else %}
      <div class="az-edt-nodata">
        <i class="fa-regular fa-calendar-xmark"></i>
        <h4>Aucune séance</h4>
        <p class="muted">Ajoute des séances (Seance) pour voir l’emploi du temps.</p>
      </div>
    {% endif %}
  </div>


</div>
{% endblock %}
