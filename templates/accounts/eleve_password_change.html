{% load static %}
<!doctype html>
<html lang="fr" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Changer mot de passe | Portail Élève</title>

  <link rel="stylesheet" href="{% static 'eleve/css/portal.css' %}">
  <link rel="stylesheet" href="{% static 'eleve/css/password_change.css' %}?v=1">
</head>
<body>
  <div class="pw-shell">
    <div class="pw-card">
      <div class="pw-head">
        <div class="pw-head-left">
          <div class="pw-ic"><i class="fa-solid fa-lock"></i></div>
          <div>
            <h2 class="pw-title">Changer le mot de passe</h2>
            <p class="pw-sub muted">Compte élève — sécurité du portail.</p>
          </div>
        </div>

        <a class="pw-back" href="{% url 'eleve:dashboard' %}">
          <i class="fa-solid fa-arrow-left"></i> Retour
        </a>
      </div>

      {% if messages %}
        <div class="pw-messages">
          {% for m in messages %}
            <div class="pw-msg {{ m.tags }}">
              <i class="fa-solid fa-circle-info"></i>
              <div>{{ m }}</div>
            </div>
          {% endfor %}
        </div>
      {% endif %}

      <form method="post" class="pw-form" id="pwForm" novalidate>
        {% csrf_token %}

        <!-- current -->
        <div class="pw-field">
          <label class="pw-label muted">Mot de passe actuel</label>
          <div class="pw-input">
            <input class="inp" type="password" name="current_password" id="pwCurrent" placeholder="••••••••" required autocomplete="current-password">
            <button class="pw-eye" type="button" data-eye="pwCurrent" aria-label="Afficher/Masquer">
              <i class="fa-regular fa-eye"></i>
            </button>
          </div>
          <div class="pw-hint muted">Obligatoire pour confirmer que c’est bien toi.</div>
        </div>

        <!-- new -->
        <div class="pw-field">
          <label class="pw-label muted">Nouveau mot de passe</label>
          <div class="pw-input">
            <input class="inp" type="password" name="password1" id="pw1" placeholder="Min. 8 caractères recommandé" required autocomplete="new-password">
            <button class="pw-eye" type="button" data-eye="pw1" aria-label="Afficher/Masquer">
              <i class="fa-regular fa-eye"></i>
            </button>
          </div>

          <div class="pw-meter" aria-hidden="true">
            <div class="pw-bar" id="pwBar"></div>
          </div>
          <div class="pw-meter-text muted" id="pwMeterText">Force : —</div>

          <ul class="pw-rules muted" id="pwRules">
            <li data-rule="len">Au moins 8 caractères</li>
            <li data-rule="num">Au moins 1 chiffre</li>
            <li data-rule="mix">Majuscule + minuscule (recommandé)</li>
          </ul>
        </div>

        <!-- confirm -->
        <div class="pw-field">
          <label class="pw-label muted">Confirmer le nouveau mot de passe</label>
          <div class="pw-input">
            <input class="inp" type="password" name="password2" id="pw2" placeholder="Retape le mot de passe" required autocomplete="new-password">
            <button class="pw-eye" type="button" data-eye="pw2" aria-label="Afficher/Masquer">
              <i class="fa-regular fa-eye"></i>
            </button>
          </div>
          <div class="pw-hint muted" id="pwMatchHint">—</div>
        </div>

        <button class="btn primary pw-submit" type="submit">
          <i class="fa-solid fa-shield-halved"></i>
          Mettre à jour
        </button>

        <div class="pw-footer muted">
          Astuce : une phrase facile à retenir + chiffres (ex: “Az2026!Portail”).
        </div>
      </form>
    </div>
  </div>

  <!-- FontAwesome si pas déjà chargé dans portal.css/layout -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
  <script defer src="{% static 'eleve/js/password_change.js' %}?v=1"></script>
</body>
</html>
