{% extends "admin/base_admin.html" %}

{% block title %}Supprimer | AZ{% endblock %}
{% block page_title %}Supprimer un élève{% endblock %}
{% block breadcrumb %}Scolaire / Élèves / Supprimer{% endblock %}

{% block content %}
<div class="az-card" style="grid-column:span 12;max-width:900px;">
  <!-- Header -->
  <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:14px;flex-wrap:wrap;">
    <div>
      <h2 style="margin:0 0 6px 0;">Confirmation</h2>
      <p class="az-sub" style="margin:0;">
        Tu es sur le point de gérer la suppression / l’archivage de :
        <b>{{ eleve.nom }} {{ eleve.prenom }}</b> (<b>{{ eleve.matricule }}</b>)
      </p>
    </div>

    <div>
      {% if eleve.is_active %}
        <span class="az-pill pill-success">Actif</span>
      {% else %}
        <span class="az-pill pill-danger">Archivé</span>
      {% endif %}
    </div>
  </div>

  <!-- Stats -->
  <div class="az-card" style="padding:14px; margin: 14px 0;">
    <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;">
      <div class="az-info-item" style="margin:0">
        <span class="label">Inscriptions</span>
        <span class="value"><b>{{ nb_inscriptions }}</b></span>
      </div>
      <div class="az-info-item" style="margin:0">
        <span class="label">Paiements</span>
        <span class="value"><b>{{ nb_paiements }}</b></span>
      </div>
      <div class="az-info-item" style="margin:0">
        <span class="label">Action recommandée</span>
        <span class="value">
          {% if nb_inscriptions|default:0 > 0 %}
            <b>Archivage</b>
          {% else %}
            <b>Suppression</b>
          {% endif %}
        </span>
      </div>
    </div>

    {% with ins=eleve.inscriptions.first %}
      {% if ins %}
        <hr style="border:none;border-top:1px solid var(--az-border);margin:12px 0;">
        <div class="label" style="margin-bottom:6px;">Dernière inscription</div>
        <div style="display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px;">
          <div class="az-info-item" style="margin:0">
            <span class="label">Année</span>
            <span class="value">{{ ins.annee.nom }}</span>
          </div>
          <div class="az-info-item" style="margin:0">
            <span class="label">Degré</span>
            <span class="value">{{ ins.groupe.niveau.degre.nom }}</span>
          </div>
          <div class="az-info-item" style="margin:0">
            <span class="label">Niveau</span>
            <span class="value">{{ ins.groupe.niveau.nom }}</span>
          </div>
          <div class="az-info-item" style="margin:0">
            <span class="label">Groupe</span>
            <span class="value highlight">{{ ins.groupe.nom }}</span>
          </div>
        </div>
      {% endif %}
    {% endwith %}
  </div>

  <!-- Actions -->
  <form method="post" style="display:grid;gap:12px;">
    {% csrf_token %}

    <!-- Safe block -->
    <div class="az-card" style="padding:14px;">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
        <div>
          <div style="font-weight:700;">Option 1 — Archivage (recommandé)</div>
          <div class="az-sub" style="margin-top:4px;">
            L’élève est masqué des listes et du quotidien, mais reste consultable (historique).
          </div>
        </div>

        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          {% if eleve.is_active %}
            <button class="az-btn az-btn-gradient" type="submit" name="action" value="archive">
              <i class="fa-solid fa-box-archive"></i> Archiver
            </button>
          {% else %}
            <button class="az-btn az-btn-outline" type="submit" name="action" value="restore">
              <i class="fa-solid fa-rotate-right"></i> Restaurer
            </button>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Danger block -->
    <div class="az-card" style="padding:14px; border:1px solid rgba(255,80,80,.25); background:rgba(255,80,80,.04);">
      <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;">
        <div>
          <div style="font-weight:800;color:rgba(255,120,120,.95);">Option 2 — Suppression définitive (DANGEREUX)</div>
          <div class="az-sub" style="margin-top:4px;">
            Cette action efface aussi inscriptions, échéances, paiements, recouvrement, etc.
          </div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <label class="label">Confirmation obligatoire</label>
        <input class="az-input" type="text" name="confirm"
               placeholder="Tape le matricule exact pour confirmer (ex: AZ-000123)">
        <div class="az-sub" style="margin-top:6px;">
          Tu dois taper exactement : <b>{{ eleve.matricule }}</b>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
        <button class="az-btn" type="submit" name="action" value="hard"
                style="border-color:rgba(255,80,80,.35);">
          <i class="fa-solid fa-trash"></i> Supprimer définitivement
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;">
      <a class="az-btn az-btn-outline" href="{% url 'core:eleve_detail' eleve.id %}">
        Annuler
      </a>
    </div>
  </form>
</div>
{% endblock %}
