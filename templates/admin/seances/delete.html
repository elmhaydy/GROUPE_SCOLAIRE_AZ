{% extends "admin/base_admin.html" %}
{% block title %}Supprimer sÃ©ance{% endblock %}
{% block page_title %}Supprimer une sÃ©ance{% endblock %}
{% block breadcrumb %}PÃ©dagogie / Emploi du temps / Supprimer{% endblock %}

{% block content %}
<div class="az-card" style="grid-column:span 12;">

  <h3>Confirmation</h3>
  <p class="az-sub">
    Supprimer la sÃ©ance :
    <b>{{ s.annee.nom }}</b> â€”
    {{ s.groupe.niveau.degre.nom }}/{{ s.groupe.niveau.nom }}/{{ s.groupe.nom }} â€”
    <b>{{ s.jour }} {{ s.heure_debut }}-{{ s.heure_fin }}</b>
    â€” {{ s.enseignant.nom }} {{ s.enseignant.prenom }}
    {% if s.matiere %} â€” {{ s.matiere }}{% endif %}
    {% if s.salle %} (Salle {{ s.salle }}){% endif %}
    ?
  </p>

  {% if absences_bloquantes %}
    <div class="az-alert az-alert-danger" style="margin-top:14px;">
      <b>âš ï¸ Attention</b><br>
      Cette sÃ©ance est liÃ©e Ã  <b>{{ absences_bloquantes|length }}</b> absence(s).<br>
      - Suppression normale : bloquÃ©e<br>
      - <b>Forcer</b> : supprimera dâ€™abord ces absences, puis la sÃ©ance.
    </div>

    <div style="margin-top:14px;">
      <h4 style="margin:0 0 10px 0;">Absences liÃ©es</h4>

      <ul style="padding-left:18px;margin:0;">
        {% for a in absences_bloquantes %}
          <li style="margin-bottom:8px;">
            <b>{{ a.date }}</b> â€”
            {{ a.eleve.matricule }} â€” {{ a.eleve.nom }} {{ a.eleve.prenom }}
            â€” <b>{{ a.get_type_display }}</b>
            {% if a.justifie %} âœ… JustifiÃ©e{% endif %}
            {% if a.motif %} â€” {{ a.motif }}{% endif %}

            <div style="margin-top:6px;display:flex;gap:8px;flex-wrap:wrap;">
              <a class="az-btn az-btn-soft" href="{% url 'core:absence_update' a.id %}">
                Modifier lâ€™absence
              </a>
              <a class="az-btn az-btn-soft" href="{% url 'core:absence_delete' a.id %}">
                Supprimer lâ€™absence
              </a>
            </div>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <form method="post" style="margin-top:18px;display:flex;gap:10px;flex-wrap:wrap;">
    {% csrf_token %}

    {% if absences_bloquantes %}
      <!-- Normal delete (bloquÃ©) -->
      <button class="az-btn" type="submit" name="action" value="delete" disabled
              style="opacity:.5;cursor:not-allowed;border-color:rgba(255,80,80,.35);">
        ğŸ—‘ï¸ Suppression normale bloquÃ©e
      </button>

      <!-- Force delete -->
      <button class="az-btn" type="submit" name="action" value="force"
              style="border-color:rgba(255,80,80,.35);">
        âš ï¸ ğŸ—‘ï¸ Forcer la suppression
      </button>
    {% else %}
      <button class="az-btn" type="submit" name="action" value="delete"
              style="border-color:rgba(255,80,80,.35);">
        ğŸ—‘ï¸ Oui, supprimer
      </button>
    {% endif %}

    <a class="az-btn az-btn-gradient" href="{% url 'core:seance_list' %}">
      Annuler
    </a>
  </form>

</div>
{% endblock %}
