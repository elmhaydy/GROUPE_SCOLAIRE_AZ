{% extends "admin/base_admin.html" %}
{% load static %}

{% block title %}Absences du jour | AZ{% endblock %}
{% block page_title %}Absences du jour{% endblock %}
{% block breadcrumb %}Pédagogie / Absences / Jour{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'admin/css/absences/list.css' %}?v=1">
{% endblock %}

{% block content %}

<div class="az-page-head">
  <div class="az-page-head-left">
    <div class="az-pill">
      <i class="fa-solid fa-calendar-day"></i>
      <span>Liste des absences — <b>{{ date_selected }}</b></span>
    </div>
  </div>

  <div class="az-page-head-right">
    <a class="az-btn az-btn-soft" href="{% url 'core:absence_list' %}">
      <i class="fa-solid fa-list"></i> Toutes les absences
    </a>

    <a class="az-btn az-btn-primary"
       href="{% url 'core:absence_create' %}?annee={{ annee_selected }}&groupe={{ groupe_selected }}&date={{ date_selected }}">
      <i class="fa-solid fa-plus"></i> Ajouter
    </a>

    <button class="az-btn az-btn-ghost" type="button" id="btn_print">
      <i class="fa-solid fa-print"></i> Imprimer
    </button>

    <a class="az-btn az-btn-outline"
       href="{% url 'core:absences_jour_pdf' %}?annee={{ annee_selected }}&groupe={{ groupe_selected }}&date={{ date_selected }}">
      <i class="fa-solid fa-file-pdf"></i> PDF
    </a>
  </div>
</div>

<div class="az-filter-bar">
  <form method="get" class="az-filter-form" id="jourFilters">

    <div class="az-filter-label">
      <i class="fa-solid fa-filter"></i>
      <span>Filtres</span>
    </div>

    <div class="az-field">
      <div class="az-field-label">Date</div>
      <input class="az-input az-input-date" type="date" id="id_date" name="date" value="{{ date_selected }}">
    </div>

    <div class="az-field">
      <div class="az-field-label">Année</div>
      <select class="az-select" id="id_annee" name="annee">
        <option value="">(Auto: année active)</option>
        {% for a in annees %}
          <option value="{{ a.id }}" {% if a.id|stringformat:"s" == annee_selected %}selected{% endif %}>
            {{ a.nom }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="az-field az-field-grow">
      <div class="az-field-label">Groupe</div>
      <select class="az-select az-select-wide" id="id_groupe" name="groupe">
        <option value="">Tous</option>
        {% for g in groupes %}
          <option value="{{ g.id }}" {% if g.id|stringformat:"s" == groupe_selected %}selected{% endif %}>
            {{ g.niveau.degre.nom }} / {{ g.niveau.nom }} / {{ g.nom }}
          </option>
        {% endfor %}
      </select>
    </div>

    <button class="az-btn az-btn-soft" type="submit">
      <i class="fa-solid fa-magnifying-glass"></i> Afficher
    </button>

    <a class="az-btn az-btn-ghost" href="{% url 'core:absences_jour' %}">
      <i class="fa-solid fa-rotate-right"></i> Reset
    </a>

  </form>
</div>

<div class="az-card az-jour-card">
  <div class="az-card-head">
    <h3 class="az-card-title">
      <i class="fa-solid fa-user-xmark"></i>
      Absences du jour
    </h3>
  </div>

  <div class="az-table az-jour-table">
    <div class="az-thead">
      <div>Élève</div>
      <div>Groupe</div>
      <div>Type</div>
      <div>Séance</div>
      <div>Justifié</div>
      <div class="az-th-actions">Actions</div>
    </div>

    <div class="az-tbody">
      {% for a in absences %}
        <div class="az-row">

          <div class="az-cell">
            <div class="az-strong">{{ a.eleve.matricule }}</div>
            <div class="az-sub">{{ a.eleve.nom }} {{ a.eleve.prenom }}</div>
          </div>

          <div class="az-cell az-sub">
            <b>{{ a.groupe.nom }}</b>
          </div>

          <div class="az-cell">
            {% if a.type == "ABS" %}
              <span class="az-badge az-badge-danger">
                <i class="fa-solid fa-circle-xmark"></i> Absence
              </span>
            {% else %}
              <span class="az-badge az-badge-warn">
                <i class="fa-solid fa-clock"></i> Retard
              </span>
            {% endif %}
          </div>

          <div class="az-cell az-sub">
            {% if a.seance %}
              {{ a.seance.get_jour_display }} {{ a.seance.heure_debut }}–{{ a.seance.heure_fin }}
            {% else %}
              —
            {% endif %}
          </div>

          <div class="az-cell">
            {% if a.justifie %}
              <span class="az-badge az-badge-success"><i class="fa-solid fa-check"></i> Oui</span>
            {% else %}
              <span class="az-badge az-badge-muted">—</span>
            {% endif %}
          </div>

          <div class="az-cell az-actions">
            <a class="az-btn az-btn-outline" href="{% url 'core:absence_update' a.id %}">
              <i class="fa-solid fa-pen"></i>
            </a>
            <a class="az-btn az-btn-danger-soft" href="{% url 'core:absence_delete' a.id %}">
              <i class="fa-solid fa-trash"></i>
            </a>
          </div>

        </div>
      {% empty %}
        <div class="az-empty">
          <i class="fa-solid fa-inbox"></i>
          <div>Aucune absence pour cette date.</div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'admin/js/absences/list.js' %}?v=1"></script>
{% endblock %}
