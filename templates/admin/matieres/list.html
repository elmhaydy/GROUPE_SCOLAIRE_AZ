{% extends "admin/base_admin.html" %}
{% load static %}

{% block title %}Matières | AZ{% endblock %}
{% block page_title %}Matières{% endblock %}
{% block current_page %}Pédagogie / Matières{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'admin/css/matieres/list.css' %}?v=4">
{% endblock %}

{% block content %}

<div class="az-page-head">
  <div class="az-page-head-left">
    <div class="az-pill">
      <i class="fa-solid fa-book"></i>
      <span>Gestion des matières (affectation enseignants + niveaux)</span>
    </div>
  </div>

  <div class="az-page-head-right">
    <a class="az-btn az-btn-primary" href="{% url 'core:matiere_create' %}">
      <i class="fa-solid fa-plus"></i> Ajouter
    </a>
  </div>
</div>

<div class="az-filter-bar">
  <form method="get" class="az-filter-form">

    <div class="az-filter-label">
      <i class="fa-solid fa-filter"></i>
      <span>Filtres</span>
    </div>

    <div class="az-field">
      <div class="az-field-label">Degré</div>
      <select class="az-select" id="id_degre" name="degre">
        <option value="">— Tous —</option>
        {% for d in degres %}
          <option value="{{ d.id }}" {% if degre_selected == d.id|stringformat:"s" %}selected{% endif %}>
            {{ d.nom }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="az-field">
      <div class="az-field-label">Niveau</div>
      <select class="az-select az-select-wide" id="id_niveau" name="niveau">
        <option value="">— Tous —</option>
        {% for n in niveaux %}
          <option value="{{ n.id }}" {% if niveau_selected == n.id|stringformat:"s" %}selected{% endif %}>
            {{ n.degre.nom }} / {{ n.nom }}
          </option>
        {% endfor %}
      </select>
    </div>

    <button class="az-btn az-btn-soft" type="submit">
      <i class="fa-solid fa-magnifying-glass"></i> Filtrer
    </button>

    <a class="az-btn az-btn-ghost" href="{% url 'core:matiere_list' %}">
      <i class="fa-solid fa-rotate-right"></i> Réinitialiser
    </a>

  </form>
</div>

<div class="az-card az-mat-card">
  <div class="az-card-head">
    <h3 class="az-card-title">
      <i class="fa-solid fa-layer-group"></i>
      Liste des matières
    </h3>
  </div>

  <div class="az-table az-table-premium">
    <div class="az-thead">
      <div>Nom</div>
      <div>Code</div>
      <div>Niveaux</div>
      <div>Enseignants</div>
      <div>Actif</div>
      <div class="az-th-actions">Actions</div>
    </div>

    <div class="az-tbody">
      {% for m in matieres %}
        <div class="az-row">

          <div class="az-cell az-strong" data-label="Nom">
            {{ m.nom }}
          </div>

          <div class="az-cell" data-label="Code">
            {% if m.code %}
              <span class="az-code">{{ m.code }}</span>
            {% else %}
              <span class="az-sub">—</span>
            {% endif %}
          </div>

          <div class="az-cell" data-label="Niveaux">
            <div class="az-tags">
              {% for n in m.niveaux.all %}
                <span class="az-badge az-badge-muted">{{ n.nom }}</span>
              {% empty %}
                <span class="az-sub">—</span>
              {% endfor %}
            </div>
          </div>

          <div class="az-cell" data-label="Enseignants">
            <div class="az-tags">
              {% for e in m.enseignants.all %}
                <span class="az-badge az-badge-info">
                  {{ e.nom }} {{ e.prenom }}
                </span>
              {% empty %}
                <span class="az-sub">—</span>
              {% endfor %}
            </div>
          </div>

          <div class="az-cell" data-label="Actif">
            {% if m.is_active %}
              <span class="az-badge az-badge-success">
                <i class="fa-solid fa-check"></i> Oui
              </span>
            {% else %}
              <span class="az-badge az-badge-muted">Non</span>
            {% endif %}
          </div>

          <div class="az-cell az-actions" data-label="Actions">
            <a class="az-btn az-btn-ghost az-btn-sm"
               href="{% url 'core:matiere_update' m.id %}"
               aria-label="Modifier {{ m.nom }}"
               title="Modifier">
              <i class="fa-solid fa-pen"></i>
              <span class="az-hide-sm">Modifier</span>
            </a>

            <a class="az-btn az-btn-ghost az-btn-sm az-btn-danger"
               href="{% url 'core:matiere_delete' m.id %}"
               aria-label="Supprimer {{ m.nom }}"
               title="Supprimer">
              <i class="fa-solid fa-trash"></i>
              <span class="az-hide-sm">Supprimer</span>
            </a>
          </div>

        </div>
      {% empty %}
        <div class="az-empty">
          <i class="fa-solid fa-inbox"></i>
          <div>Aucune matière.</div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  window.AZ_MAT = { autoSubmit: true };
</script>
<script src="{% static 'admin/js/matieres/list.js' %}"></script>

{% endblock %}
