{% extends "admin/base_admin.html" %}
{% load static %}
{% load core_extras %}

{% block title %}Niveaux | AZ{% endblock %}
{% block page_title %}Niveaux{% endblock %}
{% block current_page %}Structure / Niveaux{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'admin/css/niveaux/list.css' %}?v=3">
{% endblock %}

{% block content %}

<div class="az-page-head">
  <div class="az-page-head-left">
    <div class="az-pill">
      {% if annee_active %}
        <i class="fa-solid fa-circle-check"></i>
        <span>Année active : <b>{{ annee_active.nom }}</b></span>
      {% else %}
        <i class="fa-solid fa-triangle-exclamation"></i>
        <span>Aucune année active</span>
      {% endif %}
    </div>
  </div>

  <div class="az-page-head-right">
    <a class="az-btn az-btn-outline" href="{% url 'core:degre_list' %}">
      <i class="fa-solid fa-school"></i> Degrés
    </a>

    <a class="az-btn az-btn-primary" href="{% url 'core:niveau_create' %}">
      <i class="fa-solid fa-plus"></i> Ajouter
    </a>
  </div>
</div>

<div class="az-filter-bar">
  <form method="get" class="az-filter-form">
    <div class="az-filter-label">
      <i class="fa-solid fa-filter"></i>
      <span>Filtre degré</span>
    </div>

    <select name="degre" id="id_degre" class="az-select">
      <option value="">Tous</option>
      {% for d in degres %}
        <option value="{{ d.id }}" {% if d.id|stringformat:"s" == degre_selected %}selected{% endif %}>
          {{ d.nom }}
        </option>
      {% endfor %}
    </select>

    <button class="az-btn az-btn-soft" type="submit">
      <i class="fa-solid fa-magnifying-glass"></i> Filtrer
    </button>

    <a class="az-btn az-btn-ghost" href="{% url 'core:niveau_list' %}">
      <i class="fa-solid fa-rotate-right"></i> Reset
    </a>
  </form>
</div>

<div class="az-card az-niveau-card">
  <div class="az-card-head">
    <h3 class="az-card-title">
      <i class="fa-solid fa-layer-group"></i>
      Liste des niveaux
    </h3>
  </div>

  <div class="az-table">
    <div class="az-thead">
      <div>Degré</div>
      <div>Ordre</div>
      <div>Nom</div>
      <div>Capacité</div>
      <div>Frais ({% if annee_active %}{{ annee_active.nom }}{% else %}—{% endif %})</div>
      <div class="az-th-actions">Actions</div>
    </div>

    <div class="az-tbody">

      {% if rows %}
        {% for r in rows %}
          <div class="az-row">
            <div class="az-cell">
              <span class="az-badge az-badge-muted">
                <i class="fa-solid fa-school"></i> {{ r.degre.nom }}
              </span>
            </div>

            <div class="az-cell">
              <span class="az-badge az-badge-muted">
                <i class="fa-solid fa-hashtag"></i> {{ r.niveau.ordre }}
              </span>
            </div>

            <div class="az-cell az-strong">{{ r.niveau.nom }}</div>
<div class="az-cell">
  <span class="az-badge az-badge-muted">
    <i class="fa-solid fa-users"></i> <b>{{ r.capacite }}</b> élèves
  </span>
</div>
            <div class="az-cell">
              {% if annee_active %}
                <div style="display:flex; flex-direction:column; gap:6px;">
                  <span class="az-badge az-badge-muted">
                    <i class="fa-solid fa-file-invoice"></i>
                    Inscription: <b>{{ r.inscription }}</b> MAD
                  </span>

                  <span class="az-badge az-badge-muted">
                    <i class="fa-solid fa-calendar-days"></i>
                    Mensuel  : <b>{{ r.mensuel }}</b> MAD
                  </span>
                </div>
              {% else %}
                <span class="az-muted">—</span>
              {% endif %}
            </div>


            <div class="az-cell az-actions">
              <a class="az-btn az-btn-soft" href="{% url 'core:niveau_prix_edit' r.niveau.id %}">
                <i class="fa-solid fa-coins"></i> Prix
              </a>

              <a class="az-btn az-btn-outline" href="{% url 'core:niveau_update' r.niveau.id %}">
                <i class="fa-solid fa-pen"></i> Modifier
              </a>

              <a class="az-btn az-btn-sm az-btn-danger-soft" href="{% url 'core:niveau_delete' r.niveau.id %}">
                <i class="fas fa-trash"></i> Supprimer
              </a>
            </div>
          </div>
        {% empty %}
          <div class="az-empty">
            <i class="fa-solid fa-inbox"></i>
            <div>Aucun niveau.</div>
          </div>
        {% endfor %}

      {% else %}
        {% for n in niveaux %}
          <div class="az-row">
            <div class="az-cell">
              <span class="az-badge az-badge-muted">
                <i class="fa-solid fa-school"></i> {{ n.degre.nom }}
              </span>
            </div>

            <div class="az-cell">
              <span class="az-badge az-badge-muted">
                <i class="fa-solid fa-hashtag"></i> {{ n.ordre }}
              </span>
            </div>

            <div class="az-cell az-strong">{{ n.nom }}</div>

            <div class="az-cell">
              {% with prix=prix_by_niveau_id|get_item:n.id %}
                {% if annee_active and prix %}
                  <span class="az-price"><b>{{ prix }}</b> MAD</span>
                {% else %}
                  <span class="az-muted">—</span>
                {% endif %}
              {% endwith %}
            </div>

            <div class="az-cell az-actions">
              <a class="az-btn az-btn-soft" href="{% url 'core:niveau_prix_edit' n.id %}">
                <i class="fa-solid fa-coins"></i> Prix
              </a>

              <a class="az-btn az-btn-outline" href="{% url 'core:niveau_update' n.id %}">
                <i class="fa-solid fa-pen"></i> Modifier
              </a>

              <a class="az-btn az-btn-sm az-btn-danger-soft" href="{% url 'core:niveau_delete' n.id %}">
                <i class="fas fa-trash"></i> Supprimer
              </a>
            </div>
          </div>
        {% empty %}
          <div class="az-empty">
            <i class="fa-solid fa-inbox"></i>
            <div>Aucun niveau.</div>
          </div>
        {% endfor %}
      {% endif %}

    </div>
  </div>
</div>

{% endblock %}
